diff --git a/src/engine/flat_base.hpp b/src/engine/flat_base.hpp
index a02607628f3f..0116200444ae 100644
--- a/src/engine/flat_base.hpp
+++ b/src/engine/flat_base.hpp
@@ -73,10 +73,10 @@ public:
 
             blocked[blocked_position] = top.is_opaque();
 
-            /*int block_light = br_block_light.get4(y + 1);
-            int sky_light = br_sky_light.get4(y + 1, 15);*/
+            int block_light = br_block_light.get4(y + 1);
+            int sky_light = br_sky_light.get4(y + 1, 15);
 
-            //apply_shading(s, block_light, sky_light, 0, abs_y, top);
+            bool locked_color = apply_shading(s, block_light, sky_light, 0, abs_y, top);
 
             point p(x, abs_y, z);
 
@@ -96,7 +96,7 @@ public:
               break;
             case mc::LargeFlowerBlock:
               // Check if the requested block is the top block
-              if(block_data & 0x08) {
+              if(!locked_color && (block_data & 0x08)) {
                 // Small sanity check
                 if(y > 0 && br_blocks.get8(y-1) == block_type) {
                   // Minecraft currently doesn't set the lower bits to the
diff --git a/src/engine/functions.cpp b/src/engine/functions.cpp
index 7f0f18adf59e..511b71658a0b 100644
--- a/src/engine/functions.cpp
+++ b/src/engine/functions.cpp
@@ -1,6 +1,6 @@
 #include "engine/functions.hpp"
 
-void apply_shading(
+bool apply_shading(
         const engine_settings& s,
         int block_light,
         int sky_light,
@@ -8,6 +8,7 @@ void apply_shading(
         int y,
         color &c)
 {
+  bool locked_color;
   if(s.night) {
     c.darken(0x6 * (16 - block_light));
   }
@@ -19,12 +20,15 @@ void apply_shading(
   
   // in heightmap mode, brightness = height
   if (s.heightmap) {
-    c.b = y*2;
-    c.g = y*2;
-    c.r = y*2;
-    c.a = 0xff;
+    c.b = 1.0f * y / 256;
+    c.g = 1.0f * y / 256;
+    c.r = 1.0f * y / 256;
+    //c.a = 1.0f;
+    locked_color = true;
   }
   else if (s.striped_terrain && y % 2 == 0) {
     c.darken(0xf);
   }
+
+  return locked_color;
 }
diff --git a/src/engine/functions.hpp b/src/engine/functions.hpp
index ecac957d3842..adbb7f61d8a1 100644
--- a/src/engine/functions.hpp
+++ b/src/engine/functions.hpp
@@ -13,7 +13,7 @@
 /**
  * Apply shading to specified block and color.
  **/
-void apply_shading(
+bool apply_shading(
     const engine_settings& engine_s,
     int bl, int sl, int hm, int y, color &c);
 
